!function(){var a=function(a){var b=this,c=a,d=function(){!function(a){function f(){return a("<div/>")}var b=Math.abs,c=Math.max,d=Math.min,e=Math.round;a.imgAreaSelect=function(g,h){function Z(a){return a+r.left-v.left}function $(a){return a+r.top-v.top}function _(a){return a-r.left+v.left}function ab(a){return a-r.top+v.top}function bb(a){var c,b=db(a)||a;return(c=parseInt(b.pageX))?c-v.left:void 0}function cb(a){var c,b=db(a)||a;return(c=parseInt(b.pageY))?c-v.top:void 0}function db(a){var b=a.originalEvent||{};
return b.touches&&b.touches.length?b.touches[0]:!1}function eb(a){var b=a||C,c=a||D;return{x1:e(P.x1*b),y1:e(P.y1*c),x2:e(P.x2*b)-1,y2:e(P.y2*c)-1,width:e(P.x2*b)-e(P.x1*b),height:e(P.y2*c)-e(P.y1*c)}}function fb(a,b,c,d,f){var g=f||C,h=f||D;P={x1:e(a/g||0),y1:e(b/h||0),x2:e(c/g||0),y2:e(d/h||0)},P.width=P.x2-P.x1,P.height=P.y2-P.y1}function gb(){j&&i.width()&&(r={left:e(i.offset().left),top:e(i.offset().top)},s=i.innerWidth(),t=i.innerHeight(),r.top+=i.outerHeight()-t>>1,r.left+=i.outerWidth()-s>>1,F=e(h.minWidth/C)||0,G=e(h.minHeight/D)||0,H=e(d(h.maxWidth/C||1<<24,s)),I=e(d(h.maxHeight/D||1<<24,t)),v="fixed"==x?{left:a(document).scrollLeft(),top:a(document).scrollTop()}:/static|^$/.test(u.css("position"))?{left:0,top:0}:{left:e(u.offset().left)-u.scrollLeft(),top:e(u.offset().top)-u.scrollTop()},p=Z(0),q=$(0),(P.x2>s||P.y2>t)&&qb())
}function hb(b){if(K){switch(k.css({left:Z(P.x1),top:$(P.y1)}).add(l).width(W=P.width).height(X=P.height),l.add(m).add(o).css({left:0,top:0}),m.width(c(W-m.outerWidth()+m.innerWidth(),0)).height(c(X-m.outerHeight()+m.innerHeight(),0)),a(n[0]).css({left:p,top:q,width:P.x1,height:t}),a(n[1]).css({left:p+P.x1,top:q,width:W,height:P.y1}),a(n[2]).css({left:p+P.x2,top:q,width:s-P.x2,height:t}),a(n[3]).css({left:p+P.x1,top:q+P.y2,width:W,height:t-P.y2}),W-=o.outerWidth(),X-=o.outerHeight(),o.length){case 8:a(o[4]).css({left:W>>1}),a(o[5]).css({left:W,top:X>>1}),a(o[6]).css({left:W>>1,top:X}),a(o[7]).css({top:X>>1});
case 4:o.slice(1,3).css({left:W}),o.slice(2,4).css({top:X})}b!==!1&&(a.imgAreaSelect.keyPress!=Ab&&a(document).unbind(a.imgAreaSelect.keyPress,a.imgAreaSelect.onKeyPress),h.keys&&a(document)[a.imgAreaSelect.keyPress](a.imgAreaSelect.onKeyPress=Ab))}}function ib(a){gb(),hb(a),L=Z(P.x1),M=$(P.y1),N=Z(P.x2),O=$(P.y2)}function jb(a,b){h.fadeDuration?a.fadeOut(h.fadeDuration,b):a.hide()}function kb(a){return R&&!/^touch/.test(a.type)}function lb(a){var b=_(bb(a))-P.x1,c=ab(cb(a))-P.y1;E="",h.resizable&&(c<=h.resizeMargin?E="n":c>=P.height-h.resizeMargin&&(E="s"),b<=h.resizeMargin?E+="w":b>=P.width-h.resizeMargin&&(E+="e")),k.css("cursor",E?E+"-resize":h.movable?"move":"")
}function mb(a){kb(a)||(Y||(gb(),Y=!0,k.one("mouseout",function(){Y=!1})),lb(a))}function nb(b){R=!1,a("body").css("cursor",""),(h.autoHide||P.width*P.height==0)&&jb(k.add(n),function(){a(this).hide()}),a(document).off("mousemove touchmove",sb),k.on("mousemove touchmove",mb),b&&h.onSelectEnd(g,eb())}function ob(b){return"mousedown"==b.type&&1!=b.which?!1:("touchstart"==b.type?(R&&nb(),R=!0,lb(b)):gb(),E?(L=Z(P["x"+(1+/w/.test(E))]),M=$(P["y"+(1+/n/.test(E))]),N=Z(P["x"+(1+!/w/.test(E))]),O=$(P["y"+(1+!/n/.test(E))]),A=N-bb(b),B=O-cb(b),a(document).on("mousemove touchmove",sb).one("mouseup touchend",nb),k.off("mousemove touchmove",mb)):h.movable?(y=p+P.x1-bb(b),z=q+P.y1-cb(b),k.off("mousemove touchmove",mb),a(document).on("mousemove touchmove",ub).one("mouseup touchend",function(){R=!1,h.onSelectEnd(g,eb()),a(document).off("mousemove touchmove",ub),k.on("mousemove touchmove",mb)
})):i.mousedown(b),!1)}function pb(a){J&&(a?(N=c(p,d(p+s,L+b(O-M)*J*(N>L||-1))),O=e(c(q,d(q+t,M+b(N-L)/J*(O>M||-1)))),N=e(N)):(O=c(q,d(q+t,M+b(N-L)/J*(O>M||-1))),N=e(c(p,d(p+s,L+b(O-M)*J*(N>L||-1)))),O=e(O)))}function qb(){L=d(L,p+s),M=d(M,q+t),b(N-L)<F&&(N=L-F*(L>N||-1),p>N?L=p+F:N>p+s&&(L=p+s-F)),b(O-M)<G&&(O=M-G*(M>O||-1),q>O?M=q+G:O>q+t&&(M=q+t-G)),N=c(p,d(N,p+s)),O=c(q,d(O,q+t)),pb(b(N-L)<b(O-M)*J),b(N-L)>H&&(N=L-H*(L>N||-1),pb()),b(O-M)>I&&(O=M-I*(M>O||-1),pb(!0)),P={x1:_(d(L,N)),x2:_(c(L,N)),y1:ab(d(M,O)),y2:ab(c(M,O)),width:b(N-L),height:b(O-M)}
}function rb(){qb(),hb(),h.onSelectChange(g,eb())}function sb(a){return kb(a)?void 0:(qb(),N=/w|e|^$/.test(E)||J?bb(a)+A:Z(P.x2),O=/n|s|^$/.test(E)||J?cb(a)+B:$(P.y2),rb(),!1)}function tb(b,c){N=(L=b)+P.width,O=(M=c)+P.height,a.extend(P,{x1:_(L),y1:ab(M),x2:_(N),y2:ab(O)}),hb(),h.onSelectChange(g,eb())}function ub(a){return kb(a)?void 0:(L=c(p,d(y+bb(a),p+s-P.width)),M=c(q,d(z+cb(a),q+t-P.height)),tb(L,M),a.preventDefault(),!1)}function vb(){a(document).off("mousemove touchmove",vb),gb(),N=L,O=M,rb(),E="",n.is(":visible")||k.add(n).hide().fadeIn(h.fadeDuration||0),K=!0,a(document).off("mouseup touchend",wb).on("mousemove touchmove",sb).one("mouseup touchend",nb),k.off("mousemove touchmove",mb),h.onSelectStart(g,eb())
}function wb(){a(document).off("mousemove touchmove",vb).off("mouseup touchend",wb),jb(k.add(n)),fb(_(L),ab(M),_(L),ab(M)),this instanceof a.imgAreaSelect||(h.onSelectChange(g,eb()),h.onSelectEnd(g,eb()))}function xb(b){return"mousedown"==b.type&&1!=b.which||n.is(":animated")?!1:(R="touchstart"==b.type,gb(),y=L=bb(b),z=M=cb(b),A=B=0,a(document).on({"mousemove touchmove":vb,"mouseup touchend":wb}),!1)}function yb(){ib(!1)}function zb(){j=!0,Bb(h=a.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},h)),k.add(n).css({visibility:""}),h.show&&(K=!0,gb(),hb(),k.add(n).hide().fadeIn(h.fadeDuration||0)),setTimeout(function(){h.onInit(g,eb())
},0)}function Bb(b){if(b.parent&&(u=a(b.parent)).append(k).append(n),a.extend(h,b),gb(),null!=b.handles){for(o.remove(),o=a([]),U=b.handles?"corners"==b.handles?4:8:0;U--;)o=o.add(f());o.addClass(h.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:w+1||1}),!parseInt(o.css("width"))>=0&&o.width(5).height(5)}for(C=h.imageWidth/s||1,D=h.imageHeight/t||1,null!=b.x1&&(fb(b.x1,b.y1,b.x2,b.y2),b.show=!b.hide),b.keys&&(h.keys=a.extend({shift:1,ctrl:"resize"},b.keys)),n.addClass(h.classPrefix+"-outer"),l.addClass(h.classPrefix+"-selection"),U=0;U++<4;)a(m[U-1]).addClass(h.classPrefix+"-border"+U);
k.append(l.add(m)).append(o),Cb&&((V=(n.css("filter")||"").match(/opacity=(\d+)/))&&n.css("opacity",V[1]/100),(V=(m.css("filter")||"").match(/opacity=(\d+)/))&&m.css("opacity",V[1]/100)),b.hide?jb(k.add(n)):b.show&&j&&(K=!0,k.add(n).fadeIn(h.fadeDuration||0),ib()),J=(T=(h.aspectRatio||"").split(/:/))[0]/T[1],i.add(n).off("mousedown touchstart",xb),h.disable||h.enable===!1?(k.off({"mousemove touchmove":mb,"mousedown touchstart":ob}),a(window).off("resize",yb)):((h.enable||h.disable===!1)&&((h.resizable||h.movable)&&k.on({"mousemove touchmove":mb,"mousedown touchstart":ob}),a(window).resize(yb)),h.persistent||i.add(n).on("mousedown touchstart",xb)),h.enable=h.disable=void 0
}var j,p,q,s,t,u,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,R,S,T,U,V,W,X,Y,i=a(g),k=f(),l=f(),m=f().add(f()).add(f()).add(f()),n=f().add(f()).add(f()).add(f()),o=a([]),r={left:0,top:0},v={left:0,top:0},w=0,x="absolute",P={x1:0,y1:0,x2:0,y2:0,width:0,height:0},Q=navigator.userAgent,Ab=function(a){var e,f,b=h.keys,g=a.keyCode;if(e=isNaN(b.alt)||!a.altKey&&!a.originalEvent.altKey?!isNaN(b.ctrl)&&a.ctrlKey?b.ctrl:!isNaN(b.shift)&&a.shiftKey?b.shift:isNaN(b.arrows)?10:b.arrows:b.alt,"resize"==b.arrows||"resize"==b.shift&&a.shiftKey||"resize"==b.ctrl&&a.ctrlKey||"resize"==b.alt&&(a.altKey||a.originalEvent.altKey)){switch(g){case 37:e=-e;
case 39:f=c(L,N),L=d(L,N),N=c(f+e,L),pb();break;case 38:e=-e;case 40:f=c(M,O),M=d(M,O),O=c(f+e,M),pb(!0);break;default:return}rb()}else switch(L=d(L,N),M=d(M,O),g){case 37:tb(c(L-e,p),M);break;case 38:tb(L,c(M-e,q));break;case 39:tb(L+d(e,s-_(N)),M);break;case 40:tb(L,M+d(e,t-ab(O)));break;default:return}return!1};this.remove=function(){Bb({disable:!0}),k.add(n).remove()},this.getOptions=function(){return h},this.setOptions=Bb,this.getSelection=eb,this.setSelection=fb,this.cancelSelection=wb,this.update=ib;var Cb=(/msie ([\w.]+)/i.exec(Q)||[])[1],Db=/webkit/i.test(Q)&&!/chrome/i.test(Q);
for(S=i;S.length;)w=c(w,isNaN(S.css("z-index"))?w:S.css("z-index")),h.parent||"fixed"!=S.css("position")||(x="fixed"),S=S.parent(":not(body)");w=h.zIndex||w,a.imgAreaSelect.keyPress=Cb||Db?"keydown":"keypress",k.add(n).hide().css({position:x,overflow:"hidden",zIndex:w||"0"}),k.css({zIndex:w+2||2}),l.add(m).css({position:"absolute",fontSize:0}),g.complete||"complete"==g.readyState||!i.is("img")?zb():i.one("load",zb),!j&&Cb&&Cb>=7&&(g.src=g.src)},a.fn.imgAreaSelect=function(b){return b=b||{},this.each(function(){a(this).data("imgAreaSelect")?b.remove?(a(this).data("imgAreaSelect").remove(),a(this).removeData("imgAreaSelect")):a(this).data("imgAreaSelect").setOptions(b):b.remove||(void 0===b.enable&&void 0===b.disable&&(b.enable=!0),a(this).data("imgAreaSelect",new a.imgAreaSelect(this,b)))
}),b.instance?a(this).data("imgAreaSelect"):this}}(c)};d(),b.resolveWith(d)};FD40.module("imgareaselect",a)}();